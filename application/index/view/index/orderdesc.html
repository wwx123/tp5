<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="keywords" content="JRclassroom">
    <meta name="description" content="">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <title>订单详情</title>
    <link rel="stylesheet" href="./css/orderdesc/m_web.css">
    <script charset="utf-8" src="./js/orderdesc/v.js"></script>
    <script src="./js/orderdesc/hm.js"></script>
    <script async="" src="./js/orderdesc/sensorsdata.min.js"></script>
    <script type="text/javascript" async="" src="./js/orderdesc/toutiao-track-log.js"></script>
    <script>
        var _web_base="http://t.flowerplus.cn/".replace(/^https?:/,window.location.protocol);
        document.domain="flowerplus.cn";
    </script>
    <script src="./js/orderdesc/jquery.js"></script>
    <script src="./js/orderdesc/jweixin-1.2.0.js"></script>
    <script src="./js/orderdesc/m.js"></script>

<style>


.ships-item{
    position:relative;
    padding: 10px 2%;
}
.ships-item span.yyx{
    padding-top:0;
    color:#ff9900;
    position:absolute;
    left:50%;
    bottom:-5px;
    overflow:hidden;
    width:100%;
    text-overflow:ellipsis;
    white-space:nowrap;
    transform:translate(-50%,0);
    -webkit-transform:translate(-50%,0);
}
.ships-item a.yx{
    padding-top:0;
    display:block;
    width:40px;
    padding:0;
    border-radius:3px;
    margin:0 auto;
    line-height:20px;
    color:#fff;
    background:#ff9900;
    height:auto;
    position:absolute;
    left:50%;
    bottom:-5px;
    transform:translate(-50%,0);
    -webkit-transform:translate(-50%,0);
}
.ships-item span.transfer{
     border: 1px solid #b4b4b4;
     width:40px;
     color:#b4b4b4;
     padding:2px 0!important;
     /* height:25px; */
     text-align:center;
     position:absolute;
     right:3px;
     top:6px;
     transform:rotate(-10deg);
     -webkit-transform:rotate(-10deg);
    /* z-index:3 */
}

   .xq dl{
    padding:15px 0;
    border-bottom: 1px solid #e5e5e5;
   }
   .xq{
    position:relative;
   }
   .fy dl{
    padding:6px 0;
   }
   .order-modify-bar a {
    padding:10px 0!important;
    background-image: none!important;
    font-size:14px!important;
    margin: 15px 8px!important;
   }
   .infoitem dd{
    text-align:right;
   }
   .infoitem dt {

    color: #666!important;
}
.infoitem dd{
  color:#413f47;
}
.close_pay{
    width:30%;
    padding:6px 0;
    text-align:center;
    display:block;
    margin:0 auto;
    border-radius:3px;
    color:#000;
}
.xq dl:last-child{
    border-bottom-width:0px!important;
}
    .edit-order-out{
        padding:15px 12px;
        border-bottom:6px solid #e5e5e5;
    }
    .edit-order{
        display:flex;
        display:-webkit-flex;
        flex-direction:row-reverse;
        -webkit-flex-direction:row-reverse;
        padding-top:15px;
    }
    .edit-order a{
        display:block;
        color:#333;
        padding:6px 8px;
        border:1px solid #898989;
        border-radius:3px;
        margin-left:15px;
    }
    .edit-order a:last-child{
        margin-left:0;
    }
    .edit-order a.current{
        border:1px solid #ff3366;
        color:#fff;
        background:#ff3366;
    }
    .edit-address{
        padding:15px;
        border-bottom:6px solid #e5e5e5;
        position:relative;
    }
    .edit-address a{
        border:1px solid #ff3366;
        background:#fff;
        color:#ff3366;
        padding:6px 10px;
        border-radius:3px;
        position:absolute;
        right:15px;
        top:40%;
        transform:translate(0,-50%);
        -webkit-transform:translate(0,-50%);
    }
    .edit-addressl{
        padding-right:100px;
    }
    .edit-addressl p{
        margin-bottom:10px;
    }
    .fix-bar{
        position:fixed;
        bottom:0;
        left:0;
        border-top:1px solid #e5e5e5;
        background:#f9f9f9;
    }
@media screen and (min-width:960px){
    .fix-bar{
        width: 640px!important;
        left: 50%!important;
        margin-left: -320px;
        background:#f9f9f9;
    }
    .ships-item span.transfer{
        right:35px;
    }
}

#paymaxwxsubmit {
    display:block;
    margin:20px 0;
    text-decoration:none;
    background:#00c739;
    color:#fff;
    font-size:18px;
    padding:10px;
    text-align:center;
    -webkit-tap-highlight-color:rgba(0,0,0,0);
    -webkit-transition:all .3s ease-out;
    transition:all .3s ease-out;
}
.ships-item a{
    line-height: 18px;
    position: relative;
    display: table;
    margin: 0 auto;
    font-size: 12px;
    width: 100%;
    height: 40px;
    border-radius: 2px;
}
.ships-item .flDate{
    display: table-cell;
    vertical-align: middle;
}
.ships-item .flDate p{
    margin: 0 5px;
    position: relative;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-width: 68px;
    margin: 0 auto;
}
.ships-item .flDate p:before{
    content: '';
    display: block;
    border-top: solid 1px #fff;
    transform: scale(1,0.5);
    -webkit-transform: scale(1,0.5);
    width: 28px;
    margin: 0 auto;
}
/********************************/
.showexpress_staff{
    display: block;
    padding-left:15px;
    margin-bottom:15px;

    /*color: #f73f65*/
}
.express_staff{
    width:50%;
    /*border: 1px solid red;*/
    float: left;
    line-height: 1.8em;
}
.express_comment{
    width:50%;
    /*border: 1px solid blue;*/
    float: left;
}
.express_comment a{
    float: left;
    margin-left:20%;
}
/*sprite-z.png*/
.best_staff{
    width:25px;
    height:25px;
    display: block;
    position: relative;

}
.bad_staff{
    width:25px;
    height:25px;
    display: block;
    position: relative;
}
/*
no bad background-position:30% -40%;
*/
.img_source{
    background:url("/Static/img/kd/sprite_zan.png") no-repeat center;
    background-size:cover;
}
.img_low1{
    background-position:30% -40%;
}
.img_low2{
    background-position:100% -40%;
}
.img_good1{
    background-position:0% -40%;
}
.img_good2{
    background-position:70% -40%;
}
.renew{
    padding: 15px ;
    display: -webkit-flex;
    display: flex;
    justify-content: space-between;
    -webkit-justify-content: space-between;
    align-items: center;
    -webkit-align-items: center;
}
input[type=checkbox].switch {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  width: 40px;
  height: 24px;
  border: 1px solid #DFDFDF;
  border-radius: 20px;
   background-color: #fff;
  position: relative;
  transition: all .2s ease-out;
}
input[type=checkbox].switch:after {
    position: absolute;
    content: "";
    left: 1px;
    top: 50%;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: #fff;
    transform: translate(0,-50%);
    transform: translate(0,-50%);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
    -webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
}
input[type=checkbox].switch:checked{
  background: #ff6688;
}
input[type=checkbox].switch:checked:after{
    left:17px;
    background: #fff;
}
/***********************************/


</style>

<!--toutiao-->
<script type="text/javascript">
    (function(root) {
        root._tt_config = true;
        var ta = document.createElement('script'); ta.type = 'text/javascript'; ta.async = true;
        ta.src = document.location.protocol + '//' + 's3.pstatp.com/bytecom/resource/track_log/src/toutiao-track-log.js';
        ta.onerror = function () {
            var request = new XMLHttpRequest();
            var web_url = window.encodeURIComponent(window.location.href);
            var js_url  = ta.src;
            var url = '//ad.toutiao.com/link_monitor/cdn_failed?web_url=' + web_url + '&js_url=' + js_url + '&convert_id=61127803569';
            request.open('GET', url, true);
            request.send(null);
        }
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ta, s);
    })(window);
</script>


    <style type="text/css">.backpack.dropzone {
  font-family: 'SF UI Display', 'Segoe UI';
  font-size: 15px;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 250px;
  height: 150px;
  font-weight: lighter;
  color: white;
  will-change: right;
  z-index: 2147483647;
  bottom: 20%;
  background: #333;
  position: fixed;
  user-select: none;
  transition: left .5s, right .5s;
  right: 0px; }
  .backpack.dropzone .animation {
    height: 80px;
    width: 250px;
    background: url("./images/hoverstate.png") left center; }
  .backpack.dropzone .title::before {
    content: 'Save to'; }
  .backpack.dropzone.closed {
    right: -250px; }
  .backpack.dropzone.hover .animation {
    animation: sxt-play-anim-hover 0.91s steps(21);
    animation-fill-mode: forwards;
    background: url("./images/hoverstate.png") left center; }

@keyframes sxt-play-anim-hover {
  from {
    background-position: 0px; }
  to {
    background-position: -5250px; } }
  .backpack.dropzone.saving .title::before {
    content: 'Saving to'; }
  .backpack.dropzone.saving .animation {
    background: url("./images/saving_loop.png") left center;
    animation: sxt-play-anim-saving steps(59) 2.46s infinite; }

@keyframes sxt-play-anim-saving {
  100% {
    background-position: -14750px; } }
  .backpack.dropzone.saved .title::before {
    content: 'Saved to'; }
  .backpack.dropzone.saved .animation {
    background: url("./images/saved.png") left center;
    animation: sxt-play-anim-saved steps(20) 0.83s forwards; }

@keyframes sxt-play-anim-saved {
  100% {
    background-position: -5000px; } }
</style></head>
  <body ontouchstart="">
        <div class="page">

<div class="order-out" style="position: relative; padding-bottom: 70px;">
<div class="padding_15 borderBottom" style="border-top:0 none;overflow:hidden">
        <dl class="infoitem;"><dt style="float:left"></dt>
            <dd style="float:left">
                <strong>待付款</strong>
            </dd>
        </dl>
        <dl class="infoitem;" style="float:right"><dt style="display:inline-block">下单时间:</dt>&nbsp;<dd style="display:inline-block"> 2017-11-17 16:42:29</dd></dl>
</div>
        <!--  -->
    <!-- 时间地址修改部分-->
        <div class="edit-address">
            <div id="oldPone" style="display:none;">15041561159</div>
            <div class="edit-addressl">
                <p>王敏  15041561159</p>
                <p>辽宁沈阳市和平区浑南新区23号</p>
            </div>
        </div>
    <!-- 时间地址修改部分 -->
    <!-- 订单的详细信息 -->
    <div>
        <p style="padding:15px;" class="borderBottom">订单信息</p>
        <!-- 图片文字信息 -->
    <div class="pinfo-wrap">
        <div class="pinfo-image"><img src="./images/orderdesc/14968310272005.jpg!sml"></div>
        <div class="pinfo-content">
            <div class="pinfo-title">简花-单品鲜花包月套餐</div>
            <div class="pinfo-sku">
                订几个月:1个月(4束)
送达日期:周一
加购46:INS花瓶
养护必备:保鲜液4包<br>
            </div>
        </div>
        <div class="pinfo-price">￥100.00</div>    </div>
    <!-- 图片文字信息 -->
        <div style="padding:0 15px;border-bottom:6px solid #e5e5e5;" class="xq">
        <!-- -----------     -->
        <!--         <dl class="infoitem borderTop"><dt>配送方式:</dt><dd>快递配送 -->
            <!--  -->
        <!-- </dd></dl> -->

        <!--区分代收点和提货地点-->
        <!--             <dl class="infoitem"><dt>收货人/手机:</dt><dd>王敏 / 15041561159</dd></dl>
            <dl class="infoitem"><dt>收货地址:</dt><dd>辽宁 沈阳市 和平区 浑南新区23号 -->
                <!--  -->
            <!-- </dd></dl> -->

        <!--  -->
        <!-- ------------- -->
        <dl class="infoitem" style="border-bottom: 0px;"><dt>订单号:</dt><dd>W2017111716422987073156814</dd></dl>
                
                        </div>
    </div>
    <!-- 订单的详细信息 -->

        <!--自动续约-->
                        <!--自动续约-->

    <!-- 费用信息    -->

    <p style="padding:15px" class="borderTop">订单费用</p>
    <div class="padding_15 fy" style="border-bottom:6px solid #e5e5e5;">
        <dl class="infoitem"><dt>商品总额:</dt><dd><span>￥100.00</span></dd></dl>
        <dl class="infoitem"><dt>运费:</dt><dd><span>￥0.00</span></dd></dl>
                <dl class="infoitem" style="border-bottom: 0px;"><dt>付款金额:</dt><dd><span class="confirm-price">￥100.00</span></dd></dl>
        </div>
    <!-- 费用信息    -->
            
    
    <!-- <div class="weiquan_wrap">

    </div> -->
    <!-- 按钮 -->
    <div class="order-modify-bar fix-bar">
    <a class="order-cancel" href="javascript:;">
        <!-- <span id="cancelorder">取消订单</span> -->
        <span>取消订单</span>
    </a>
    <!-- <a href="javascript:;" class="wait_pay" style="border-color:#ff5d7c;color:#ff5d7c">去支付</a> -->
    <a href="javascript:;" class="" style="border-color:#ff5d7c;color:#ff5d7c">去支付</a>
</div>
        <div class="order-modify-bar">
                        <!-- 
              <a href="javascript:;" class="wait_pay" style="border-color:#ff5d7c;color:#ff5d7c">去支付</a>
         -->
            <!-- 按钮 -->
    <!--  -->
            </div>
        <!-- 按钮 -->

<script type="text/javascript">
    if($(".order-modify-bar").hasClass('fix-bar')){
        $(".order-out").css('paddingBottom', '70px');
    }
</script>

    <!-- 按钮 -->
    <!--<div class="refund_ok">
        <img src="//static2.flowerplus.cn/Static/img/iconfont-success.png" width="64" />
        <p style="color:#000;padding:15px 0;line-height:2em"><strong>订单已取消</strong><p style="color:#999">如已付款，款项会在1~5个工作日内退回到付款账户</p></p>
        <p style="padding:15px 0"><a href="javascript:window.location.replace('/my/');" >我的所有订单</a></p>
    </div>-->

    <div class="right-dialog" id="shipWrap">
        <h2>发货详情<a class="right-dialog-close" href="javascript:;"></a></h2>
        <div class="right-dialog-content" style="padding:20px 0" id="shipDetail">

        </div>
    </div>

    <div class="right-dialog" id="modifyAddressWrap">
        <h2>第次起（）<a class="right-dialog-close" href="javascript:;"></a></h2>
        <div class="right-dialog-content" id="modifyAddress">
        <!-- <dl class="times-tips"><dt>第次起（）</dt><dd>请注意上方的日期</dd></dl> -->
          <dl class="deliver-item">
                <dt>收货人</dt>
                <dd><input type="text" id="receiver_name" placeholder="姓名">  </dd>
              </dl>
              <dl class="deliver-item">
                <dt>手机</dt>
                <dd><input type="tel" id="receiver_mobile" placeholder="收货人手机"> </dd>
              </dl>
              <dl class="deliver-item">
                <dt>所在地区</dt>
                <dd class="address_area">
                <select class="form-control" id="receiver_state" name="receiver_state"><option index="0" value="选择省份">选择省份</option><option index="1" value="上海">上海</option><option index="2" value="北京">北京</option><option index="3" value="江苏">江苏</option><option index="4" value="浙江">浙江</option><option index="5" value="广东">广东</option><option index="6" value="四川">四川</option><option index="7" value="天津">天津</option><option index="8" value="重庆">重庆</option><option index="9" value="贵州">贵州</option><option index="10" value="河南">河南</option><option index="11" value="湖北">湖北</option><option index="12" value="湖南">湖南</option><option index="13" value="广西">广西</option><option index="14" value="陕西">陕西</option><option index="15" value="河北">河北</option><option index="16" value="山西">山西</option><option index="17" value="安徽">安徽</option><option index="18" value="福建">福建</option><option index="19" value="江西">江西</option><option index="20" value="山东">山东</option><option index="21" value="辽宁" selected="">辽宁</option></select>
                <select class="form-control" id="receiver_city" name="receiver_city"><option index="0" value="选择城市">选择城市</option><option index="1" value="沈阳市" selected="">沈阳市</option><option index="2" value="大连市">大连市</option></select>
                <select class="form-control" id="receiver_district" name="receiver_district"><option index="0" value="选择区县">选择区县</option><option index="1" value="和平区" selected="">和平区</option><option index="2" value="沈河区">沈河区</option><option index="3" value="大东区">大东区</option><option index="4" value="皇姑区">皇姑区</option><option index="5" value="铁西区">铁西区</option><option index="6" value="苏家屯区">苏家屯区</option><option index="7" value="东陵区">东陵区</option><option index="8" value="新城子区">新城子区</option><option index="9" value="于洪区">于洪区</option><option index="10" value="辽中县">辽中县</option><option index="11" value="康平县">康平县</option><option index="12" value="法库县">法库县</option><option index="13" value="新民市">新民市</option><option index="14" value="浑南区">浑南区</option></select>
                </dd>
                <dd style="color:#999;font-size:12px;padding-top:10px">注意：只能选择"辽宁"内的区域</dd>
              </dl>
              <dl class="deliver-item">
                <dt>详细地址</dt>
                <dd><input type="text" id="receiver_address" placeholder="街道门牌信息"></dd>
            </dl>
          <div class="deliver-save-wrap"><button class="deliver-save" id="confirmaddress">保存</button></div>
          <dl class="address_log">
            <dt>历史地址</dt>
          </dl>
        </div>
    </div>

    <div class="right-dialog" id="modifyDeliveryDateWrap">
        <h2>第次起（）<a class="right-dialog-close" href="javascript:;"></a></h2>
        <div class="right-dialog-content" style="padding:20px 0" id="modifyAddress">
            <!-- <dl class="times-tips"><dt>第次起（）</dt><dd>请注意上方的日期，每次操作顺延一周，可多次操作</dd></dl> -->
            <div style="padding:20px 15px;text-align:center"><button class="deliver-save" id="confirmshunyan">点击确认顺延一周</button></div>
            <p style="text-align: center;"> 提示：如果需要顺延两周或更多，可重复操作。</p>
        </div>
    </div>
</div>

<div style="width:100%;height:100%;position:fixed;left:0;top:0;background:rgba(0,0,0,0.75);z-index:3;display:none" class="grayout"></div>
    <!-- 弹窗的事件 -->
    <div style="padding:10px 20px 20px 20px;position:fixed;background:#fff;width:90%;left:5%;bottom:50px;z-index:3;display:none" class="flower_pay">
                <div style="padding:15px 0">
        <a href="javascript:;" class="payandsubmit" payway="2" style="background:#0ae;color:#fff;width:100%;line-height:45px;display:block;text-align:center;font-size:18px;">支付宝支付</a>
        <form action="http://t.flowerplus.cn/alipay/goalipay_to" method="post" id="goalipay">
            <input type="hidden" name="out_trade_no" value="W2017111716422987073156814">
            <input type="hidden" name="subject" value="简花-单品鲜花包月套餐">
            <input type="hidden" name="total_fee" value="100.00">
            <input type="hidden" name="show_url" value="http://t.flowerplus.cn/f0">
            <input type="hidden" name="body" value="简花-单品鲜花包月套餐">
            <input type="hidden" name="id" value="10930693">
        </form>
                                    
    </div>
        
    <span class="close_pay">取消</span>
    </div>
<!-- 弹窗的事件 -->




<script type="text/html" id="address_tpl">
<dd address-id="{id}">
        <div>{receiver_name}<span class="add_mob">{receiver_mobile}</span></div>
        <div>{receiver_state} {receiver_city} {receiver_district} {receiver_address}</div>
        </dd>
</script>
<script type="text/javascript" src="./js/orderdesc/address.b.js"></script>
<script>
$.address_b.list[0]={n:'选择省份',c:[{n:'选择城市',a:['选择区县']}]};
$.address_b("receiver_state","receiver_city","receiver_district","辽宁","沈阳市","和平区");
var last_times="";
var last_date="";
var id=10930693,isruning=false,jsApiParameters="",payment="100.00",status="WAIT_PAY",productid="0";
var activity_group = '0';
var group_oid = '';
var product_name='简花-单品鲜花包月套餐';
$(".payandsubmit").bind("click",function(){
    var payway = $(this).attr('payway');
    request(payway);
});

function request(payway){
    if(parseFloat(payment)<=0){
        return;
    }
    if(isruning){
        return;
    }
    if(payway == 1){
        if(jsApiParameters!=""){
            return;
        }
        $("#payandsubmit").html("微信支付启动中...").addClass("buttondisabled");
        isruning=true;
    /*  $.post('/my/wxpay',{id:id},function(v){
            if(v.f){
                jsApiParameters=v.data;
                //alert(jsApiParameters);
                isruning=false;
                wxpay();

            }else{
                FP.showError(v.data);
                isruning=false;
                $("#payandsubmit").html("微信支付").removeClass("buttondisabled");
            }
        },"json");*/
        FP.ajaxPost(
            "/my/wxpay",
            {id:id,group_oid:group_oid,from:"orderdetail"},
            function(v){
                    isruning=false;
                    if(v.f){
                        jsApiParameters=v.data;
                        wxpay();
                    }else{
                        FP.showError(v.data);
                        $("#payandsubmit").html("微信支付").removeClass("buttondisabled");
                    }
                },
                function(){
                    isruning=false;
                    FP.showError('请求失败,请重试');
                    $("#payandsubmit").html("微信支付").removeClass("buttondisabled");
                }

            );
    }
    else if (payway == 11){
        if(jsApiParameters!=""){
            return;
        }
        $("#paymaxwxsubmit").html("微信支付启动中...").addClass("buttondisabled");
        isruning=true;

        FP.ajaxPost(
                "/my/paymaxwx",
                {id:id,group_oid:group_oid},
                function(v){
                    isruning=false;
                    if(v.f){
                        jsApiParameters=v.data;
                        paymaxwx();
                    }else{
                        FP.showError(v.data);
                        $("#paymaxwxsubmit").html("微信支付").removeClass("buttondisabled");
                    }
                },
                function(){
                    isruning=false;
                    FP.showError('请求失败,请重试');
                    $("#paymaxwxsubmit").html("微信支付").removeClass("buttondisabled");
                }

        );
    }
    else if (payway == 3){
        $('#gocmbpay').submit();
    }
    else{
        $('#goalipay').submit();
    }
}
function paymaxwx(){
    if (typeof WeixinJSBridge == "undefined"){
        if( document.addEventListener ){
            document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
        }else if (document.attachEvent){
            document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
            document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
        }
    }else{
        onBridgeReady();
    }
}

function onBridgeReady(){
    WeixinJSBridge.invoke(
        'getBrandWCPayRequest',
        eval("("+jsApiParameters+")"),
        function(res){
            jsApiParameters="";
            if(res.err_msg == "get_brand_wcpay_request:ok" ) {
                var whenpayok=function(){
                    if(productid=="1018"){
                        window.location.reload();
                    }else{
                        if(activity_group == 1){
                            window.location.href="/activity_group/detail?oid="+group_oid;
                        }else{
                            window.location.replace('/my/');
                        }
                    }
                    isruning=false;
                    $("#paymaxwxsubmit").html("微信支付").removeClass("buttondisabled");
                };
                isruning=true;
                $("#paymaxwxsubmit").html("正在确认支付结果，请稍候！").addClass("buttondisabled");
                FP.ajaxPost(
                    '/paymaxpay/check_pay_status/',
                    {id:id},
                    function(v){
                        whenpayok();
                    },
                    function(v){
                        whenpayok();
                    }
                );
            }else{
                isruning=false;
                $("#paymaxwxsubmit").html("微信支付").removeClass("buttondisabled");
            }
        }
    )
}


//$(function(){wxpayConditionComplete()});
window.onload = function(){
    wxpayConditionComplete();
}

function wxpay(){
    if(typeof WeixinJSBridge != "undefined"){
        wxpayConditionComplete();
    }else{
        if( document.addEventListener ){
            document.addEventListener('WeixinJSBridgeReady', wxpayConditionComplete, false);
        }else if (document.attachEvent){
            document.attachEvent('WeixinJSBridgeReady', wxpayConditionComplete);
            document.attachEvent('onWeixinJSBridgeReady', wxpayConditionComplete);
        }
    }
}
//防止页面没有加载完成启动微信支付
function wxpayConditionComplete(){
    if(typeof window._WXPAY_COUNTER == 'undefined'){
        window._WXPAY_COUNTER = 2;
    }
    window._WXPAY_COUNTER = window._WXPAY_COUNTER - 1;
    if(window._WXPAY_COUNTER <= 0 && jsApiParameters != ''){
        window.setTimeout(jsApiCall,0);
    }
}

//调用微信JS api 支付
function jsApiCall()
{
    $("#payandsubmit").html("微信支付已启动,请完成支付");
    WeixinJSBridge.invoke(
        'getBrandWCPayRequest',
        eval("("+jsApiParameters+")"),
        function(res){
            jsApiParameters="";

            if(res.err_msg == "get_brand_wcpay_request:ok" ) {
                var whenpayok=function(){
                    if(productid=="1018"){
                        window.location.reload();
                    }else{
                            if(activity_group == 1){
                                window.location.href="/activity_group/detail?oid="+group_oid;
                            }else{
                                window.location.replace('/my/order_success?oid='+id);
                            }
                    }
                    isruning=false;
                    $("#payandsubmit").html("微信支付").removeClass("buttondisabled");
                };
                isruning=true;
                $("#payandsubmit").html("正在确认支付结果，请稍候！").addClass("buttondisabled");
                FP.ajaxPost(
                    '/my/wxpaycheck/',
                    {id:id},
                    function(v){
                        whenpayok();
                    },
                    function(v){
                        whenpayok();
                    }

                );

                //window.location.reload();

            }else{
                isruning=false;
                $("#payandsubmit").html("微信支付").removeClass("buttondisabled");
            }
        }
    );
}
$("#cancelorder").bind("click",function(){
    if(isruning){
        return;
    }
    if(jsApiParameters!=""){
        return;
    }
    if(!window.confirm('确认要取消此订单？')){
        return;
    }
    var btn=$(this).html("处理中...");
    isruning=true;
    $.post('/my/cancelorder',{id:id},function(v){
        if(v.f){
            if('' == '1') {
                window.location.reload();
                return false;
            } else {
                window.location.href='/my/order_cancel';
            }
        }else{
            alert(v.data);
        }
        btn.html("取消订单");
        isruning=false;


    },"json");

    ga_cancel();
});

function weiquan(){
    //if(status!="")
    $.get("/my/weiquan",{id:id},function(){

    });
}

// if(window.location.hash=="#pay"){
//  window.location.hash="";
//  request(1);
// }

$(".ships_info").delegate("a","click",function(e){e.stopPropagation();$("#shipWrap").addClass("right-dialog-show");loadShip($(this).attr("data-id"));return false;});
$("#modifyAddress").bind("click",function(e){e.stopPropagation();$("#modifyAddressWrap").addClass("right-dialog-show");getAddress();return false;});
$("#modifyDeliveryDate").bind("click",function(e){e.stopPropagation();$("#modifyDeliveryDateWrap").addClass("right-dialog-show");return false;});
$(".right-dialog-close").bind(FP.EVENT_CLICK,function(e){e.stopPropagation();$(".right-dialog").removeClass("right-dialog-show");return false;});
$("#changeToDaishou").bind('click',function(e){
    e.stopPropagation();
    $(".order-out").hide();

    //隐藏底部菜单
    $(".order-modify-bar").hide();

    ds_show_daishou_picker_with_oid(id);
});
$("#changeDaishou").bind('click',function(e){
    e.stopPropagation();
    $(".order-out").hide();
    //隐藏底部菜单
    $(".order-modify-bar").hide();

    ds_show_daishou_picker_with_oid(id);
});
$("#cancelDaishou").bind('click',function(e){
    var confirm=window.confirm("确定取消使用代收服务吗?");
    if (confirm) {
        e.stopPropagation();
        getAddress();
        $("#modifyAddressWrap").addClass("right-dialog-show");
        FP.showError('需要您选择新的收货地址');
        return false;
    };
});

function ds_when_selected_daishou(daishou_data){
    saveAddressForDaishou(daishou_data);
};

function ds_hide_daishou_picker(){
    $(".ds_wpage").hide().siblings('.order-out').show();

    //隐藏底部菜单
    $(".order-modify-bar").show();
};


function loadShip(id){
    var wrap=$("#shipDetail").html("<div style='color:#777;text-align:center;padding:30px 0'> 加载中...</div>");
    wrap.load("/my/shipitem/?id="+id);
}
function getroute(){//alert(32);
        //console.log($(this));
        var id=$(this).attr("data-id");
        var express_com=$(this).attr("data-express-com");
        var express_id=$(this).attr("data-express-id");
        var p=$(".routes[data-id='"+id+"']").show();
        var btn=$(this).html("刷新").prop("disabled",true);
        p.html('<p style="color:#999;text-align:center;padding:10px 0">正在查询...</p>');
        $.get('/kd/getroute',{express_com:express_com,express_id:express_id,ships_id:id},function(v){
            p.html(v);
            btn.prop("disabled",false);
        })
    }
$("body").delegate(".showroute","click",getroute);
$("#confirmaddress").bind("click",function(){
    saveAddressForExpress();
});

function saveAddressForExpress(){
    var address={
        receiver_name:$("#receiver_name").val().replace('/^\s|\s$/g',''),
        receiver_mobile:$("#receiver_mobile").val().replace('/^\s|\s$/g',''),
        receiver_state:$("#receiver_state").val(),
        receiver_city:$("#receiver_city").val(),
        receiver_district:$("#receiver_district").val(),
        receiver_address:$("#receiver_address").val().replace('/^\s|\s$/g',''),
    };
    if(address.receiver_name==""){
        FP.showError("请填写收货人姓名！");
        return;
    }
    if(address.receiver_mobile==""){
        FP.showError("请填写收货人手机！");
        return;
    }
    if(address.receiver_state=="" || address.receiver_state=="选择省份"){
        FP.showError("选择省份");
        return;
    }
    if(address.receiver_city=="" || address.receiver_city=="选择城市"){
        FP.showError("选择城市");
        return;
    }
    if(address.receiver_district=="" || address.receiver_district=="选择区县"){
        FP.showError("选择区县");
        return;
    }
    if(!/^1\d{10}$/.test(address.receiver_mobile)){
        FP.showError("收货人手机号码格式错误！");
        return;
    }
    if(address.receiver_address==""){
        FP.showError("详细地址！");
        return;
    }

    var btn=$(this).prop("disabled",true);
    $.post('/buy/addaddress',address,function(v){
        if(v.f){
            //getAddress();
            $("#receiver_name").val("");
            $("#receiver_mobile").val("");
            $("#receiver_address").val("");
            $.address_b("receiver_state","receiver_city","receiver_district");
            adds=v.list;
            updateAddressList();
            selectAddress(v.id);
        }else{
            FP.showError(v.data);
        }
        btn.prop("disabled",false);
    },"json");
}

function saveAddressForDaishou(daishou_data){
    var address={
        receiver_name:daishou_data.receiver_name,
        receiver_mobile:daishou_data.receiver_mobile,
        receiver_state:daishou_data.receiver_state,
        daishou_stations:daishou_data.daishou_shop_id,
        express_type:"fetch"
    };

    if(address.receiver_name==""){
        FP.showError("请填写提货人姓名！");
        return;
    }
    if(address.receiver_mobile==""){
        FP.showError("请填写提货人手机！");
        return;
    }

    var btn=$(this).prop("disabled",true);
    $.post("/my/updateaddress/?id="+id,address,function(v){
        if(v.f){
            alert('修改成功！');
            window.location.reload();
        }else{
            FP.showError(v.data);
            btn.prop("disabled",false);
        }
    },"json");
}

var gotAddress=false;
var adds=[];
function getAddress(){
    if (gotAddress) {
        return;
    };

    gotAddress=true;
    $.get("/buy/getaddress",null,function(v){
        adds=v;
        updateAddressList();
    },"json");
}
function updateAddressList(){
    var tpl=$("#address_tpl").html();
    $(".address_log dd").remove();
    for(var i in adds){
        var item=tpl;
        item=item.replace("{id}",adds[i].id);
        item=item.replace("{receiver_name}",adds[i].receiver_name);
        item=item.replace("{receiver_mobile}",adds[i].receiver_mobile);
        item=item.replace("{receiver_state}",adds[i].receiver_state);
        item=item.replace("{receiver_city}",adds[i].receiver_city);
        item=item.replace("{receiver_district}",adds[i].receiver_district);
        item=item.replace("{receiver_address}",adds[i].receiver_address);
        $(".address_log").append(item);
    }
}

function selectAddress(addr_id){
    var address={};
    for(var i in adds){
        if(adds[i].id==addr_id){
            address=adds[i];
        }
    }

    
    address.express_type="express";
    $.post("/my/updateaddress/?id="+id,address,function(v){
        if(v.f){
            alert('修改成功！');
            $.get('/buy/updateaddressusedtime/',{id:addr_id},null);
            window.location.reload();
        }else{
            FP.showError(v.data);
        }
    },"json");
}

$(".address_log").delegate("dd","click",function(){
    selectAddress($(this).attr("address-id"));
});

$("#confirmshunyan").bind("click",function(){
    if(!window.confirm('确认要顺延一周？')){
        return;
    }
    var btn=$(this).prop("disabled",true);
    $.post("/my/confirmshunyan/?id="+id,{last_date:last_date},function(v){
        window.location.reload();
    });
});

$("#renew_switch").change(function(){
    if($(this).is(":checked")){
        $.post('/my/open_sign_order',{oid:id},function(v) {
            if(v.f){
                alert('续约成功!');
            }else {
                $("#renew_switch").prop('checked', false);
                FP.showError(v.data);
            }
        },'json');
    }else {
        $.post('/my/close_sign_order',{oid:id},function(v) {
            if(v.f){
                alert('解约成功!');
            }else {
                $("#renew_switch").prop('checked', true);
                FP.showError(v.data);
            }
        },'json');
    }
});

$(" #hideorder").bind("click",function(){
    if(!window.confirm("隐藏的订单不在用户中心显示，但不影响正常配送，请放心使用！\n确认要隐藏？")){
        return;
    }
    $.post("/my/hideorder",{id:id},function(){
        window.location.replace("/my");
    });
});
$("body").delegate("input[type='tel']","input",function(){$(this).val($(this).val().replace(/[^0-9]/g,'').replace(/^86/,''))});

$(".xq dl:last,.fy dl:last").css('border-bottom', '0');
$(".close_pay").click(function(event) {
     event.stopPropagation();
    $(".flower_pay,.grayout").hide();
});

$(".wait_pay").click(function(event) {
    if('' == '1') {
        window.location.href = '';
        return false;
    }
    ga_pay(id, product_name, payment);

    // toutiao
    _taq.push({convert_id:"61127803569", event_type:"form"});

    event.stopPropagation();
    $(".flower_pay,.grayout").show();
});

</script>
<script>
    //物流点赞2
    $(document).on('click','.zan',function () {
    var ships_id = $(this).parent('div.express_comment').parent('div.showexpress_staff').parent('div.routes').attr('data-id');
    var custmer_mobile   = $('#oldPone').html();
    var mobile_Repg = /^(13|15|17|18)+\d{9}$/;
    var content  = $(this).attr('comment');
    var staff_name = $(this).parent('div.express_comment').siblings('div.express_staff').attr('staff_name');
    var staff_mobile = $(this).parent('div.express_comment').siblings('div.express_staff').attr('staff_mobile');
    if(!ships_id){
        alert('ID错误请联系管理员');
        return false;
    }
    if(!mobile_Repg.test(custmer_mobile)){
        alert('手机号码错误');
        return false;
    }
    if(!mobile_Repg.test(staff_mobile)){
        alert('快递员手机号码错误');
        return false;
    }
    if(!staff_name){
        alert('派件员名字获取失败');
    }
    var  _this = $(this);
    $.ajax({
        url:'/kd/ajax_zan_exresss_staff',
        type:'POST',
        data:{
            ships_id:ships_id,staff_name:staff_name,staff_mobile:staff_mobile,
            custmer_mobile:custmer_mobile,content:content
        },
        success:function (res) {
            var items = JSON.parse(res);
            if(items.f){
                if(_this.find('i').hasClass('img_good1')){
                    _this.find('i').removeClass('img_good1').addClass('img_good2');
                }else if(_this.find('i').hasClass('img_low1')){
                    _this.find('i').removeClass('img_low1').addClass('img_low2');
                }
            }else{
                alert(items.data);
            }
        }
    })
    })
    </script>
    <!-- 详细地址地图的页面开始 -->
<link rel="stylesheet" type="text/css" href="./css/orderdesc/daihou.css">
<div class="map_out" style="display:none;background:#fff">
<!--  头部的部分开始 -->
	<div class="map_container_header">
	    <label>代收点地址详情</label>
	    <a class="map_close" href="http://t.flowerplus.cn/my/orderdetail/?id=10930693#"></a>
	</div>
<!--  头部的部分结束 -->    
	<div class="BMap_mask" id="BMap_mask"></div>
    <div class="Tit p3">
    	<p class="img"><img src="http://t.flowerplus.cn/my/orderdetail/?id=10930693" alt="logo" id="map_shop_logo"></p>
    	<ul>
    		<li><b id="map_shop_name"></b> <span id="map_shop_type"></span></li>
    		<li id="map_shop_time"></li>
    	</ul>
    </div>
    <p class="map_ads" id="map_shop_address"></p>
    <a href="http://t.flowerplus.cn/my/orderdetail/?id=10930693" id="map_shop_phone" class="tel p3 l40" style="display:block;color:#333"></a>
    <div class="Discount p3">
        <div class="top" id="map_shop_tip"></div>
        <p id="map_shop_detail">在设置为提货点的时间区间，您将获得合作门店认证卡，凭卡享受该门店优惠。</p>
    </div>
</div>
<!-- 详细地址地图的页面结束 -->

<!-- 提货人的页面结束 -->
<div class="taker_list_container" style="display:none;background:#fff">
    <div class="taker_list_header" style="position:relative;">
        <label>提货人管理</label>
        <a class="taker_close" href="javascript:;"></a>
    </div>
	<div class="taker_list_inputs">
        <dl class="taker-info-item">
            <dt>提货人</dt>
            <dd><input type="text" id="taker_name" placeholder="姓名">  </dd>
          </dl>
          <dl class="taker-info-item">
            <dt>电话</dt>
            <dd><input type="tel" id="taker_mobile" placeholder="提货人手机"> </dd> 
          </dl>
        <div class="taker-save-wrap"><button class="taker-save">保存</button></div>
    </div>
	<div class="taker_list_log">
        <div class="taker_list_log_title">历史提货人</div>
        <div class="taker_list_log_item">
            <table>
                <colgroup><col style="width:20%">
                <col style="width:65%">
                <col style="width:15%">
                </colgroup><tbody id="taker_list_items">
                </tbody>
            </table>
        </div>
    </div>
</div>
<!--  提货人的页面结束 -->

<!-- 代收点的页面开始-->
<div class="ds_wpage" style="display:none">
	<!-- 代收点显示一部分 -->
  <div class="wpage">
	<header style="font-size:16px;font-weight:bolder;color:#44450;line-height:45px">代收服务
		<a class="deliver-close first-deliver-close" style=""></a>
	</header>
	<!--div  class="daishou_promotion">
			代收点有优惠活动哦！
	</div-->
	<div class="banner" style="max-height: 300px;overflow: hidden;">
		<img src="./images/orderdesc/daishou.png" style="width:100%;" alt="">
		<p>我们正与品牌门店合作提供免费代收服务。您可选择附近的代收点为收货地址，收花日收到短信后在营业时间内到店自提即可。</p>
    </div>
    <p class="ads">收货地址：<span id="ads_content"></span></p>
	<p class="p3 l45 bb ti-tit">附近的代收点</p>
	<div class="daishou_recommend_list">
		<!--代收点列表-->
	</div>
	<a href="javascript:void(0);" class="select l45" style="display:inline-block;width:100%;color:#333;background:#fff!important">查看全部代收点</a>
</div>
<!-- 代收点显示一部分 -->
<!-- 全部的代收开始-->
<div class="wpage" style="display:none;background:#fff">
		 <!-- 头部的标签开始 -->
	<header clss="ALLds">
		<div class="header" style="font-size:1.6rem;font-weight:bolder;line-height:45px;">
			代收服务<a class="deliver-close second-deliver-close"></a>
		</div>
		<!-- 选择省份的输入框开始 -->
		<div class="daishou_address_area">
	 		<div class="daishou_address_div">
			    <select class="form-control" id="daishou_state" name="daishou_state"><option index="0" value="选择省份">选择省份</option><option index="1" value="上海">上海</option><option index="2" value="北京">北京</option><option index="3" value="江苏">江苏</option><option index="4" value="浙江">浙江</option><option index="5" value="广东">广东</option><option index="6" value="四川">四川</option><option index="7" value="天津">天津</option><option index="8" value="重庆">重庆</option><option index="9" value="贵州">贵州</option><option index="10" value="河南">河南</option><option index="11" value="湖北">湖北</option><option index="12" value="湖南">湖南</option><option index="13" value="广西">广西</option><option index="14" value="陕西">陕西</option><option index="15" value="河北">河北</option><option index="16" value="山西">山西</option><option index="17" value="安徽">安徽</option><option index="18" value="福建">福建</option><option index="19" value="江西">江西</option><option index="20" value="山东">山东</option><option index="21" value="辽宁">辽宁</option></select>
			    <select class="form-control" id="daishou_city" name="daishou_city"><option index="0" value="选择城市">选择城市</option></select>
			    <select class="form-control" id="daishou_district" name="daishou_district"><option index="0" value="选择区县">选择区县</option></select>
			</div>
			<div class="daishou_address_search_area">
				<button class="address_search_button"></button>
			</div>
	    </div>
		<!-- 选择省份的输入框结束 -->
	<!-- 搜索的功能开始 -->
		<div class="daishou_address_search" style="display:none">
		<div class="daishou_address_search_text">
			<input type="text" id="seach_keyword" name="seach_keyword" placeholder="请输入路名或代收点">
			<div class="daishou_address_search_button">
				<button onclick="searchWithKeyword()">搜索</button>
				<button onclick="cancelSearch()" style="background-color:#bbb">取消</button>
			</div>
		</div>
	</div>
	<!-- 搜索的功能结束 -->
	</header>
<!-- 头部的标签结束 -->	
	<div class="wrap-page full_daishou_list" style="diaplay:none">
	</div>
	</div>
 <!-- 全部的代收点结束 -->
 <!--  尾部的开始 -->
  <div class="trans1"></div>
      <footer>
       <div class="p3 clearfix name bb">
       		<p class="l" style="line-height:45px"><b>提货人:</b> <span id="taker_name_default"></span></p>
       		<p class="r" style="margin-right:30px;color:#413f47;line-height:45px"> <span id="taker_mobile_default"></span></p>
       </div>
        <button id="selected_daishou_btn">配送至代收点</button>
    </footer>
  <!--  尾部的结束-->
</div>
<!-- 代收点的页面结束 -->

<!-- 弹出框 -->
<style>
.alert_clause {width: 100%;height: 100%;background: rgba(0,0,0,0.6);z-index:2222;position: fixed;left: 0;right: 0;bottom: 0;top: 0}
.alert_clause_main { width:85%;background:#fff; position:fixed;border-radius: 4px; overflow: hidden;}
.alert_clause_main_in{ padding:10px;}
.alert_clause button{width:100%;height:30px;line-height:30px;background:#f6658f;text-align: center;color: white;border: 0;border-radius: 5px;margin-top: 10px}
.alert_clause_main_in .center{height:100px;overflow-y:auto;-webkit-overflow-scrolling:touch;}
.top span{position:absolute;right:10px;top:5px;background:url(image/iconfont-close-tiny.png);width:25px;height:25px;background-size:25px 25px;-moz-background-size:25px 25px;-webkit-background-size:25px 25px;}
.center tr td{vertical-align:top;line-height: 18px}
.center tr td:first-child{font-weight:bold;}
</style>
<div class="alert_clause" style="display:none">
    <div class="alert_clause_main">
      <div class="alert_clause_main_in">
        <div class="top">
          <p style="text-align:center;line-height:35px;font-size:16px">代收点活动介绍</p>
          <span class="close"></span>
        </div>
        <table class="center">
            <tbody>
              <tr>
                  <td>1.</td>
                  <td>在不方便收件或者对快递的服务不满意时可选择花+提供的免费代收点服务；</td>
              </tr>
              <tr>
                  <td>2.</td>
                  <td>新客户下单时选择门店代收，已下单的老客户在订单详情中更改配送方式均可领取“花+代收门店会员认证卡”，您可以在“会员中心”查看；</td>
              </tr>
              <tr>
                  <td>3.</td>
                  <td>订单结束或者更改为其他配送方式，“花+代收门店会员认证卡”将被收回；</td>
              </tr>
              <tr>
                  <td>4.</td>
                  <td>代收站点仅提供代收服务。合作门店除代收服务外，也将会不定期提供会员特权福利；</td>
              </tr>
              <tr>
                  <td>5.</td>
                  <td>凭认证卡可享受对应代收门店的优惠特权，详细信息可参考门店的红色文字提示或查看认证卡优惠说明；<b>4月13日-5月13日 </b>凡选择代收的客户，在门店每签收一次都将 <b style="color:red">获得2积分</b>（可累计获得多次积分，1积分可抵扣1元）；</td>
              </tr>
        </tbody>
        </table>
        <p style="text-align:center;font-weight:bold;color:#999"><br>花+对本活动保有最终解释权。<br></p>
        <button>知道了</button>
      </div>
    </div>       
</div>
<script>
 jQuery(document).ready(function($) {
        
   $(".close,.alert_clause button").click(function(event) {
       $(this).parents(".alert_clause").hide();
   });

    $(".daishou_promotion").click(function(){
	 	$(".alert_clause").css('display','block');
	 	var screenWidth = $(window).width();
        var screenHeight = $(window).height();
        var aW=$(".alert_clause_main").width();
        var aH=$(".alert_clause_main").height();
        $(".alert_clause_main").css({
            left:screenWidth/2-aW/2,
            top:screenHeight/2-aH/2
	 	})
  });
});


</script>
<!-- 弹出框 -->

<script type="text/html" id="daishou_list_item_tpl">
	 	<div class="daishou_list_item pa bb" itemid="{id}">
		<table style="width:100%">
			<colgroup>
				<col width="8%">
				<col width="78%">
				<col width="14%">
			</colgroup>
			<tbody>
				<tr style="height:20px">
					<td>
					<span class="daishou_list_item_radio"><b></b></span>
					</td>
					<td style="font-size:16px;font-weight:bold">{shop_name} <b class="smal-t" {type_style}>{daishou_type}</b></td>
					<td style="font-size:12px;color:#ccc"> </td>
				</tr>
			<tr>
				<td></td>
				<td style="font-size:14px;color:#888">{shop_address}<br></td>
				<td style="text-align:center"><img item="{id}" class="daishou_list_item_pointer" src="/Static/img/dw.png"></td>
			</tr>
			<tr>
				<td></td>
				<td style="font-size:14px;color:#888">营业时间 {shopping_time}  </td>
				<td style="text-align:center;font-size:12px;color:#666">{shop_distance}</td>
			</tr>
		</tbody>	
		 </table>
		 <p style="color:#fc780b;padding-left:8%;margin-top:3px;display:{comment_block}"><span style="padding:0px 4px;display:inline-block;color:#fff;background:#fc780b;border-radius:3px;margin-right:5px">惠</span>
		 	{comment} </p>
		</div>
</script>
<script type="text/html" id="takerlist_tpl">
    <tr item={id} item_name={taker_name}>
        <td>{taker_name}</td>
        <td style="text-align:right;">{taker_mobile}</td>
        <td></td>
    </tr>
</script>

<!-- <script type="text/javascript" src="//api.map.baidu.com/api?v=2.0&ak=cddPGX3yYjB5D7UvaGnzZMzq"></script> -->
<script>

var daishou_data={
	receiver_name:'',
	receiver_mobile:'',
	receiver_state:'',
	daishou_shop_id:0,
	daishou_shop_name:'',
	daishou_shop_address:'',
};

var recommended_daishou_list;
var full_daishou_list;
var map=null;
var map_marker;
var map_info_window;

$.address_b("daishou_state","daishou_city","daishou_district");
$("#daishou_state").change(daishouCityChanged);
$("#daishou_city").change(daishouCityChanged);
$("#daishou_district").change(daishouCityChanged);


//展示统一调用函数
function ds_show_daishou_picker(address_id){
	$('.ds_wpage').show();
	//加载地址数据
	if (address_id>0) {
		var post={'address_id':address_id};
		$.post('/buy/get_recommend_ds_shops',post,function(v){
			if (v.f) {
				var address=v.data.address;
				$('#ads_content').html(address.receiver_state+address.receiver_district+' '+address.receiver_address);
				$("#taker_name_default").html(address.receiver_name);
				$("#taker_mobile_default").html(address.receiver_mobile);

				daishou_data.receiver_name=address.receiver_name;
				daishou_data.receiver_mobile=address.receiver_mobile;

				$(".daishou_recommend_list").html('');
				var tpl=$("#daishou_list_item_tpl").html();
				recommended_daishou_list=v.data.shops;
				var html=daishou_list_html(recommended_daishou_list);
				$(".daishou_recommend_list").html(html);
			}else{
				alert(v.data);
			}
		},'json');
	};
}

//展示统一调用函数
function ds_show_daishou_picker_with_oid(order_id){
	$('.ds_wpage').show();
	//加载地址数据
	if (order_id>0) {
		var post={'order_id':order_id};
		$.post('/buy/get_recommend_ds_shops_for_oid',post,function(v){
			if (v.f) {
				var address=v.data.address;
				$('#ads_content').html(address.receiver_state+address.receiver_district+' '+address.receiver_address);
				$("#taker_name_default").html(address.receiver_name);
				$("#taker_mobile_default").html(address.receiver_mobile);

				daishou_data.receiver_name=address.receiver_name;
				daishou_data.receiver_mobile=address.receiver_mobile;

				$(".daishou_recommend_list").html('');
				var tpl=$("#daishou_list_item_tpl").html();
				recommended_daishou_list=v.data.shops;
				var html=daishou_list_html(recommended_daishou_list);
				$(".daishou_recommend_list").html(html);
			}else{
				alert(v.data);
			}
		},'json');
	};
}

//关闭统一调用函数,需要自己定义
//function ds_hide_daishou_picker(){};

//选择完成的统一回调,需要自己定义
//function ds_when_selected_daishou(daishou_data){};

$(".daishou_recommend_list").delegate(".daishou_list_item","click",function(event){
	event.stopPropagation();
	var check=$(this).find('.daishou_list_item_radio b')
	 if( check.css("display")=='none'){
	 	check.css('display', 'block');
	 	$(this).siblings('.daishou_list_item').find('.daishou_list_item_radio b').css('display', 'none');
	 	$(".full_daishou_list").find('.daishou_list_item_radio b').css('display', 'none');              
	 }

	var itemId=$(this).attr("itemid");
	var items = $.grep(recommended_daishou_list, function(n){
        return n.id==itemId;
    });

	var item=items[0];
	daishou_data.daishou_shop_id=itemId;
	daishou_data.daishou_shop_name=item.shop_name;
	daishou_data.daishou_shop_address=item.city+item.district+item.address;
	daishou_data.receiver_state=item.state;
});

$(".full_daishou_list").delegate(".daishou_list_item","click",function(event){
	event.stopPropagation();
	var check=$(this).find('.daishou_list_item_radio b')
	 if( check.css("display")=='none'){
	 	check.css('display', 'block');
	 	$(this).siblings('.daishou_list_item').find('.daishou_list_item_radio b').css('display', 'none');
	 	$(".daishou_recommend_list").find('.daishou_list_item_radio b').css('display', 'none');

	 	var itemId=$(this).attr("itemid");
		 var items = $.grep(full_daishou_list, function(n){
	        return n.id==itemId;
	    });

		var item=items[0];
		daishou_data.daishou_shop_id=itemId;
		daishou_data.daishou_shop_name=item.shop_name;
		daishou_data.daishou_shop_address=item.city+item.district+item.address;
		daishou_data.receiver_state=item.state;       
	 }
	 else{
	 	check.css('display', 'none');
	 	daishou_data.daishou_shop_id=0;
		daishou_data.daishou_shop_name="";
		daishou_data.daishou_shop_address="";
		daishou_data.receiver_state="";    
	 }
});

// 定位的小点的事件
$(".daishou_recommend_list").delegate(".daishou_list_item .daishou_list_item_pointer","click",function(e){	
	e.stopPropagation();
	$(this).parents('.ds_wpage').hide().siblings('.map_out').show();

	var itemId=$(this).attr("item");
	var items = $.grep(recommended_daishou_list, function(n){
        return n.id==itemId;
    });

    var item=items[0];
    bind_mapview_data(item);
 });

$(".full_daishou_list").delegate(".daishou_list_item .daishou_list_item_pointer","click",function(e){	
	e.stopPropagation();
	$(this).parents('.ds_wpage').hide().siblings('.map_out').show();

	var itemId=$(this).attr("item");
	var items = $.grep(full_daishou_list, function(n){
        return n.id==itemId;
    });

    var item=items[0];
    bind_mapview_data(item);
 });

$(".ds_wpage .first-deliver-close").click(function(event) {
	$('.ds_wpage').hide();

	//调用隐藏回调
	ds_hide_daishou_picker();
}); 
$(".ds_wpage .second-deliver-close").click(function(event) {
	$(this).parents(".wpage").hide().siblings('.wpage').show();
}); 

$(".ds_wpage .select").click(function(event) {
	$(this).parents(".wpage").hide().siblings('.wpage').show();
	searchAllSattion('上海');
});


function daishou_list_html(daishou_list){
	if (daishou_list==null||daishou_list.length==0) {
		var html="<table style=\"width:100%;border-bottom:1px solid #ddd\"><tr><td style=\"text-align:center;height:60px;color:#666\">没有找到代收点<td></tr></table>"
		return html;
	};
	
	var tpl=$("#daishou_list_item_tpl").html();
	var html='';
	for (var i = 0; i < daishou_list.length; i++) {
		var shop=daishou_list[i];
		var item=tpl;
		item=item.replace(/\{id\}/ig,shop.id);
		item=item.replace("{shop_name}",shop.shop_name);
		item=item.replace("{shop_address}",shop.city
											+shop.district
											+shop.address);

		item=item.replace("{shop_phone}",shop.shop_manager_phone);

		var comment=shop.comment;
		if (comment!=null&&$.trim(comment)!="") {
			item=item.replace("{comment_block}","block");
			item=item.replace("{comment}",comment);
		}
		else{
			item=item.replace("{comment_block}","none");
			item=item.replace("{comment}","");
		}
		
		var daishou_type=shop.daishou_type;
		if (parseInt(daishou_type)==1) {
			item=item.replace("{daishou_type}","合作门店");
			item=item.replace("{type_style}","style='background: #fb95ad;'");
		}else if (parseInt(daishou_type)==2) {
			item=item.replace("{daishou_type}","代收站点");
			item=item.replace("{type_style}","style='background: #aaa;'");
		}
		else{
			item=item.replace("{daishou_type}","");
		}
		
		if (shop.distance!=null) {
			item=item.replace("{shop_distance}",shop.distance+"米");
		}
		else{
			item=item.replace("{shop_distance}"," ");
		}

		var shopping_time=shop.start_time.substring(0,5)+" ~ "+shop.end_time.substring(0,5)
		item=item.replace("{shopping_time}",shopping_time);
		html+=item;
	}


	return html;
}

function bind_mapview_data(item){
	if (item.logo!=null) {
		$("#map_shop_logo").attr("src",item.logo);
		$(".map_info_logo").css("display","block");
	}else{
		$("#map_shop_logo").attr("src",'');
		$(".map_info_logo").css("display","none");
	}
   
    $("#map_shop_name").html(item.shop_name);

    var daishou_type=item.daishou_type;
    daishou_type=parseInt(daishou_type);
	if (daishou_type==1) {
		$("#map_shop_type").html("合作门店");
		$("#map_shop_type").css("background","#fb95ad");
	}else if (daishou_type==2) {
		$("#map_shop_type").html("代收站点");
		$("#map_shop_type").css("background","#aaa");
	}

	var shopping_time=item.start_time.substring(0,5)+" ~ "+item.end_time.substring(0,5);
	$("#map_shop_time").html("营业时间："+shopping_time);

	var fullAddress=item.city+item.district+item.address;
	$("#map_shop_address").html("地址："+fullAddress);
	$("#map_shop_phone").html(item.shop_manager_phone);
	$("#map_shop_phone").attr("href","tel://"+item.shop_manager_phone);

    if (item.comment!=null&& $.trim(item.comment).length>0) {
        $("#map_shop_tip").html("<label>惠</label> "+item.comment);
        $("#map_shop_detail").css("display","inline-block");
    }
    else{
    	$("#map_shop_tip").html("");
    	$("#map_shop_detail").css("display","none");
    }

    if($.isEmptyObject(map)){
        map = new BMap.Map("BMap_mask");
        map.addControl(new BMap.GeolocationControl());
    	var opts = {type: BMAP_NAVIGATION_CONTROL_ZOOM};    
    	map.addControl(new BMap.NavigationControl(opts));
    	map.disableDragging();  
    }

    map_marker=null;
    map.removeOverlay(map_marker);

    var opts = {    
        width:0,        
        height:0,
        offset:new BMap.Size(0, -25),    
        title:"<h3>"+item.shop_name+"</h3>",
        maxWidth:220 
    }

    var center = new BMap.Point(item.lng, item.lat);  
    map_marker = new BMap.Marker(center);     
    map.addOverlay(map_marker);  
    map.centerAndZoom(center, 18);

    map_info_window = new BMap.InfoWindow(fullAddress, opts);    
    setTimeout(function (){
        map.openInfoWindow(map_info_window, center);  
    }, 500);
}

function daishouCityChanged(){
	var address={
		state:$("#daishou_state").val(),
		city:$("#daishou_city").val(),
		district:$("#daishou_district").val()
	};

	$.post('/buy/search_stations',address,function(v){
		full_daishou_list=v;
		var html=daishou_list_html(full_daishou_list);
		$(".full_daishou_list").html(html);
	},"json");
}

$(".address_search_button").click(function(event) {
	$(".daishou_address_search").css('display', 'block');
	$(".daishou_address_search_text input").focus();
});

function cancelSearch(){
	$(".daishou_address_search").css("display","none");
	$(".daishou_address_search_text input").focus();
}

function searchWithKeyword(){
	var keyword= $("#seach_keyword").val();
	keyword=$.trim(keyword);
	if (keyword.length>=2) {
		$(".daishou_address_search").css("display","none");

		var info={
			k:keyword
		};

		$.post('/buy/search_stations',info,function(v){
			full_daishou_list=v;
			var html=daishou_list_html(full_daishou_list);
			$(".full_daishou_list").html(html);
		},"json");
	}
	else{
		alert("至少输入两个关键字");
	}
}

function searchAllSattion(city){
	var info={
			k:"all",
		};

	if (city!=null) {
		info.city=city;
	};

	$.post('/buy/search_stations',info,function(v){
		full_daishou_list=v;
		var html=daishou_list_html(full_daishou_list);
		$(".full_daishou_list").html(html);
	},"json");
}

$(".map_out .map_close").click(function(event) {
	$(this).parents(".map_out").hide().siblings('.ds_wpage').show();
});

$("#selected_daishou_btn").click(function(e){
	if (daishou_data.daishou_shop_id==0) {
		FP.showError("请选择一个门店！");
		return;
	};

	if (daishou_data.receiver_name=='') {
		FP.showError("请填写提货人！");
		return;
	};

	if (daishou_data.receiver_mobile=='') {
		FP.showError("请填写提货人手机号！");
		return;
	};

	ds_when_selected_daishou(daishou_data);
	$(".taker_list_container").hide();
	$(".ds_wpage").hide();
	$(".map_out").hide();

	//调用隐藏回调
	ds_hide_daishou_picker();
});

</script>

<script>
var all_takers=[];
$("footer .name").click(function(event) {
 	$(this).parents(".ds_wpage").hide().siblings('.taker_list_container').show();
 	if (all_takers.length==0){
         updateAllTakersList();
     };
});

$(".taker_list_container .taker_close").click(function(event) {
	$(".taker_list_container").hide().siblings(".ds_wpage").show();
});

$(".taker-save").bind("click",function(e){
    e.stopPropagation();
    var info={
        taker_name:$("#taker_name").val().replace('/^\s|\s$/g',''),
        taker_mobile:$("#taker_mobile").val().replace('/^\s|\s$/g',''),
    };

    if(info.taker_name==""){
        FP.showError("请填写提货人姓名！");
        return;
    }
    if(info.taker_mobile==""){
        FP.showError("请填写提货人手机！");
        return;
    }

    var btn=$(this).prop("disabled",true);
    $.post('/buy/add_daishou_takers',info,function(v){
        if(v.f){
            $("#taker_name").val("");
            $("#taker_mobile").val("");
            adds=v.list;
            updateAllTakersList();
        }else{
            FP.showError(v.data);
        }
        btn.prop("disabled",false);
    },"json");
});

function updateAllTakersList(){
    $.get('/buy/get_daishou_takers',function(v){
        if(v){
            all_takers=v;
            var tpl=$("#takerlist_tpl").html();
            $("#taker_list_items").html('');
            for(var i in all_takers){
                var item=tpl;
                item=item.replace(/\{id\}/ig,all_takers[i].id);
                item=item.replace(/\{taker_name\}/ig,all_takers[i].taker_name);
                item=item.replace("{taker_mobile}",all_takers[i].taker_mobile);
                $("#taker_list_items").append(item);
            }

            //找到需要选中的dom然后选中
            if (daishou_data.hasOwnProperty("daishou_taker_name")) {
                $("#taker_list_items tr").each(function(){ 
                    if ($(this).attr("item_name")==data.daishou_taker_name) {
                        $(this).find("td:eq(2)").addClass("add-sel");
                    }; 
                });
            }
        }
    },"json");
}

$("#taker_list_items").delegate("tr","click",function(){
    $("#taker_list_items tr td").removeClass("add-sel");
    $(this).find("td:eq(2)").addClass("add-sel");

    //记录代收取货人id
    var itemId=$(this).attr('item');
    
    //更新界面
    var items = $.grep(all_takers, function(n){
        return n.id==itemId;
    });

    var item=items[0];
    $("#taker_name_default").html(item.taker_name);
	$("#taker_mobile_default").html(item.taker_mobile);

	daishou_data.receiver_name=item.taker_name;
	daishou_data.receiver_mobile=item.taker_mobile;

    $(".taker_list_container").hide().siblings(".ds_wpage").show();
});

</script>


    
        </div>

<script>
var page_type = '';
var sat = 'cb037e036c03aad3';
var sap = 'default';
var sau = 'https://flowerplus.cloud.sensorsdata.cn:4006/sa?token='+sat+'&project='+sap;
(function(para) {
  var p = para.sdk_url, n = para.name, w = window, d = document, s = 'script',x = null,y = null;
  w['sensorsDataAnalytic201505'] = n;
  w[n] = w[n] || function(a) {return function() {(w[n]._q = w[n]._q || []).push([a, arguments]);}};
  var ifs = ['track','quick','register','registerPage','registerOnce','clearAllRegister','trackSignup', 'trackAbtest', 'setProfile','setOnceProfile','appendProfile', 'incrementProfile', 'deleteProfile', 'unsetProfile', 'identify','login','logout','trackLink','clearAllRegister'];
  for (var i = 0; i < ifs.length; i++) {
    w[n][ifs[i]] = w[n].call(null, ifs[i]);
  }
  if (!w[n]._t) {
    x = d.createElement(s), y = d.getElementsByTagName(s)[0];
    x.async = 1;
    x.src = p;
    y.parentNode.insertBefore(x, y);
    w[n].para = para;
  }
})({
  sdk_url: '//static2.flowerplus.cn/Static/js/sa/sensorsdata.min.js?_t=20170807',
  name: 'sa',
  web_url: 'https://flowerplus.cloud.sensorsdata.cn/',
  server_url: sau,
  heatmap: {
      isTrackLink: false,
      //设置成 true 后，我们会自动给 a 标签绑定一个 sa.trackLink() 方法（详见本页 3.3 ），如果是单页面 a 标签不涉及页面跳转或者 a 标签的点击是下载功能，建议不要打开。默认 false 。
      loadTimeout:  1000,
      //设置多少毫秒后开始渲染点击图
      collect_url: function(){
          // 限制只采集微信端
          // && location.pathname.match(/^(\/)$|^(\/my\/?)$/g) !== null
          if (location.hostname === 't.flowerplus.cn' || location.hostname === 'static2.flowerplus.cn') {
              return true;
          }
      }
      //返回true会采集当前页面的数据，返回false等假值表示不采集当前页面,设置这个函数后，内容为空的话，默认是返回假的。不写这个函数，默认是采集所有页面。
  }
  ,
  // debug_mode:true,
  debug_mode_upload:true
});





  param_data = {};

  
  
  sa.quick('autoTrackWithoutProfile', param_data);

</script>


<script type="text/javascript" src="./js/orderdesc/fpa.channel.js"></script>
<script>
var fp_utm_source = getQueryString('utm_source');
if (fp_utm_source != '' && fp_utm_source != null) {
    setCookie('fpa_channel_utm_source', fp_utm_source, null, '/', '.flowerplus.cn');
}
</script>

<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?deb1341df19187ec5a232b519d62c8a9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>

<!--暂停google统计-->
<!-- 
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
              ga('create', 'UA-93082500-1', 'auto');
              ga('send', 'pageview');
</script>
-->
<script>
    function exist_ga(){return typeof ga == 'function';}
    function ga_buy(){if(!exist_ga())return;ga("send",{hitType:"event",eventCategory:"订购流程",eventAction:"立即购买",eventLabel:"详情页购买"})}
    function ga_submit(){if(!exist_ga())return;ga("send",{hitType:"event",eventCategory:"订购流程",eventAction:"确认下单",eventLabel:"订单填写页"})}
    function ga_cancel(){if(!exist_ga())return;ga("send",{hitType:"event",eventCategory:"订购流程",eventAction:"取消订单",eventLabel:"订单确认页"})}
    function ga_pay(id,product_name,payment){if(!exist_ga())return;ga("send",{hitType:"event",eventCategory:"订购流程",eventAction:"去支付",eventLabel:"订单确认页"});ga("require","ecommerce");ga("ecommerce:addTransaction",{"id":id,"affiliation":product_name,"revenue":payment,});ga("ecommerce:send")};
</script>
</body></html>